CREATE TYPE "Rank" AS ENUM (
    'None',
    'Member',
    'Moderator',
    'Admin',
    'Owner'
);


// CREATE_ACCOUNT FUNCTION NEEDS TO BE REDONE TO CHECK FOR VALUES

CREATE FUNCTION create_account(id varchar, username varchar, email varchar, password varchar, rank public."Rank")
RETURNS BOOLEAN
AS $$
BEGIN
	IF is_username_taken(username) THEN
		RETURN FALSE;
	END IF;
	IF is_email_taken(email) THEN
		RETURN FALSE;
	END IF;
	INSERT INTO accounts (id, username, email, password, rank) VALUES(id, username, email, password, rank);
	RETURN TRUE;
END;
$$ LANGUAGE plpgsql;

// is username taken

CREATE FUNCTION is_username_taken(target_username VARCHAR) RETURNS BOOLEAN
AS $$
BEGIN 
	RETURN EXISTS(SELECT 1 from accounts WHERE username = target_username);
END;
$$ LANGUAGE plpgsql;

// is email taken...

CREATE FUNCTION is_email_taken(target_email VARCHAR) RETURNS BOOLEAN
AS $$
BEGIN 
	IF EXISTS(SELECT 1 from accounts WHERE email = target_email) = true THEN
		RAISE EXCEPTION 'The email % is already taken', target_email USING ERRCODE = 'unique_violation';
		RETURN TRUE;
	END IF;
	RETURN FALSE;
END;
$$ LANGUAGE plpgsql;



DOMAIN CONSTRAINTS
CREATE DOMAIN email AS varchar(255)
CHECK (value ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$');



POSTGRES Error Codes
USUV1 <- Username is taken.
EMUV2 <- Email is taken.